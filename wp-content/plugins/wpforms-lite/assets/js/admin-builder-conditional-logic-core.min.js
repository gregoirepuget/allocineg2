!function($){var e={init:function(){e.bindUIActions()},bindUIActions:function(){$(document).on("change",".wpforms-conditionals-enable-toggle input[type=checkbox]",function(t){e.conditionalToggle(this,t)}),$(document).on("change",".wpforms-conditional-field",function(t){e.conditionalField(this,t)}),$(document).on("change",".wpforms-conditional-operator",function(t){e.conditionalOperator(this,t)}),$(document).on("click",".wpforms-conditional-rule-add",function(t){e.conditionalRuleAdd(this,t)}),$(document).on("click",".wpforms-conditional-rule-delete",function(t){e.conditionalRuleDelete(this,t)}),$(document).on("click",".wpforms-conditional-groups-add",function(t){e.conditionalGroupAdd(this,t)}),$(document).on("wpformsFieldUpdate",e.conditionalUpdateOptions)},conditionalUpdateOptions:function(e,t,i){i=i||$(".wpforms-conditional-row");var o=$.extend({},t),n=["text","textarea","select","radio","email","url","checkbox","number","payment-multiple","payment-select","hidden"],l=[],a="",d="";if(!wpf.empty(o)){for(a in o)-1===$.inArray(o[a].type,n)?delete o[a]:void 0!==o[a].dynamic_choices&&""!==o[a].dynamic_choices&&delete o[a];if(i.each(function(e,t){var i=$(this),n=i.attr("data-field-id"),r=i.find(".wpforms-conditional-field"),c=r.find("option:selected").val(),p=i.find(".wpforms-conditional-value"),f="";r.empty().append($("<option>",{value:"",text:wpforms_builder.select_field}));for(a in o)d=o[a].label.length?wpf.sanitizeString(o[a].label):wpforms_builder.field+" #"+o[a].id,n&&n===o[a].id||r.append($("<option>",{value:o[a].id,text:d}));if(!c)return!0;if(r.find('option[value="'+c+'"]').length){if(r.find('option[value="'+c+'"]').prop("selected",!0),p.length&&p.is("select")){f=p.find("option:selected").val(),p.empty(),p.append($("<option>",{value:"",text:wpforms_builder.select_choice}));for(a in o["field_"+c].choices)d=wpf.sanitizeString(o["field_"+c].choices[a].label),p.append($("<option>",{value:o["field_"+c].choices[a].key,text:d}));p.find('option[value="'+f+'"]').length?p.find('option[value="'+f+'"]').prop("selected",!0):f.length>0&&l.push(i.closest(".wpforms-conditional-group").data("reference"))}}else{l.push(i.closest(".wpforms-conditional-group").data("reference"));var s=i.closest(".wpforms-conditional-group");if(1===s.find("table >tbody >tr").length){i.closest(".wpforms-conditional-groups").find(".wpforms-conditional-group").length>1?s.remove():(i.find(".wpforms-conditional-value").remove(),i.find(".value").append("<select>"))}else i.remove()}}),l.length>0){var r=l.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[]),c=wpforms_builder.conditionals_change;for(a in r)wpf.isNumber(r[a])?t["field_"+r[a]].label.length?c+="<br/>"+wpf.sanitizeString(t["field_"+r[a]].label)+" ("+wpforms_builder.field+" #"+r[a]+")":c+="<br>"+wpforms_builder.field+" #"+r[a]:c+="<br>"+r[a];$.alert({title:wpforms_builder.heads_up,content:c,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})}}},conditionalToggle:function(t,i){i.preventDefault();var o=$(t),n=o.parent().parent(),l=wp.template("wpforms-conditional-block"),a={fieldID:o.parent().data("field-id"),fieldName:o.data("name"),actions:o.data("actions"),actionDesc:o.data("action-desc")};o.is(":checked")?(n.append(l(a)),e.conditionalUpdateOptions(!1,wpf.getFields(!1,!0),n.find(".wpforms-conditional-row"))):$.confirm({title:!1,content:wpforms_builder.conditionals_disable,backgroundDismiss:!1,closeIcon:!1,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",action:function(){n.find(".wpforms-conditional-groups").remove()}},cancel:{text:wpforms_builder.cancel,action:function(){o.prop("checked",!0)}}}})},conditionalField:function(t,i){i.preventDefault();var o=$(t),n=o.parent().parent(),l=n.find(".wpforms-conditional-operator"),a=l.find("option:selected").val(),d=e.conditionalData(o),r=d.inputName+"["+d.groupID+"]["+d.ruleID+"][value]",c;if(d.field)if("select"===d.field.type||"radio"===d.field.type||"checkbox"===d.field.type||"payment-multiple"===d.field.type||"payment-select"===d.field.type){if(c=$("<select>").attr({name:r,class:"wpforms-conditional-value"}),c.append($("<option>",{value:"",text:wpforms_builder.select_choice})),d.field.choices)for(var p in d.field.choices)c.append($("<option>",{value:d.field.choices[p].key,text:wpf.sanitizeString(d.field.choices[p].label)}));l.find("option:not([value='=='],[value='!='],[value='e'],[value='!e'])").prop("disabled",!0).prop("selected",!1)}else c=$("<input>").attr({type:"text",name:r,class:"wpforms-conditional-value"}),l.find("option").prop("disabled",!1);else c=$("<select>");"e"!==a&&"!e"!==a||c.prop("disabled",!0),n.find(".value").empty().append(c)},conditionalOperator:function(e,t){t.preventDefault();var i=$(e),o=i.parent().parent(),n=o.find(".wpforms-conditional-value"),l=i.find("option:selected").val();"e"===l||"!e"===l?(n.prop("disabled",!0),n.is("select")?n.find("option:selected").prop("selected",!1):n.val("")):n.prop("disabled",!1)},conditionalRuleAdd:function(t,i){i.preventDefault();var o=$(t),n=o.closest(".wpforms-conditional-group"),l=n.find("tr").last(),a=l.clone(),d=a.find(".wpforms-conditional-field"),r=a.find(".wpforms-conditional-operator"),c=e.conditionalData(d),p=Number(c.ruleID)+1,f=c.inputName+"["+c.groupID+"]["+p+"]";a.find("option:selected").prop("selected",!1),a.find(".value").empty().append($("<select>")),d.attr("name",f+"[field]").attr("data-ruleid",p),r.attr("name",f+"[operator]"),l.after(a)},conditionalRuleDelete:function(e,t){t.preventDefault();var i=$(e),o=i.closest(".wpforms-conditional-group"),n=o.find("table >tbody >tr");if(n&&1===n.length){if(!(i.closest(".wpforms-conditional-groups").find(".wpforms-conditional-group").length>1))return;o.remove()}else i.parent().parent().remove()},conditionalGroupAdd:function(t,i){i.preventDefault();var o=$(t),n=o.parent().find(".wpforms-conditional-group").last(),l=n.clone();l.find("tr").not(":first").remove();var a=l.find(".wpforms-conditional-field"),d=l.find(".wpforms-conditional-operator"),r=e.conditionalData(a),c=Number(r.groupID)+1,p=0,f=r.inputName+"["+c+"][0]";l.find("option:selected").prop("selected",!1),l.find(".value").empty().append($("<select>")),a.attr("name",f+"[field]").attr("data-ruleid",0).attr("data-groupid",c),d.attr("name",f+"[operator]"),o.before(l)},conditionalData:function(e){var t=$(e),i={fields:wpf.getFields(!1,!0),inputBase:t.closest(".wpforms-conditional-row").attr("data-input-name"),fieldID:t.closest(".wpforms-conditional-row").attr("data-field-id"),ruleID:t.attr("data-ruleid"),groupID:t.attr("data-groupid"),selectedID:t.find(":selected").val()};return i.inputName=i.inputBase+"[conditionals]",i.selectedID.length?i.field=i.fields["field_"+i.selectedID]:i.field=!1,i}};e.init()}(jQuery);